<!doctype html>

<meta charset="utf-8">
<title>首页</title>
<link rel="stylesheet" href="stylesheets/jquery-ui.css">
<style>
    .hidden {
        display: none;
    }
    
    #menu {
        list-style: none;
    }
    
    #menu li {
        cursor: pointer;
    }
</style>
<select id="functionList">
    <option value="">请选择</option>
</select>
<p>Date: <input type="text" id="datepicker"></p>
<div style="width:800px;height:400px">
    <canvas id="myChart" width="400" height="400"></canvas>
</div>
<script src="javascripts/jquery.js"></script>
<script src="javascripts/jquery-ui.js"></script>
<script src="javascripts/date.js"></script>
<script src="javascripts/Chart.js"></script>
<script>
    var currentBegin, currentEnd;
    $.get('common/functionList', {}, function(data) {
        for (var i = 0; i < data.length; i++) {
            var aData = data[i];
            $('<option>').attr('value', aData.value).text(aData.label).appendTo('#functionList');
        }
    });

    var ctx = document.getElementById("myChart").getContext("2d");
    mydate.select("#datepicker", function(begin, end) {
        currentBegin = begin;
        currentEnd = end;
        fetchData(begin, end);
    });
    $('#functionList').on('change', function(event) {
        fetchData(currentBegin, currentEnd);
    });

    function fetchData(begin, end) {
        var url = $('#functionList').val();
        if (!url || !begin || !end) return; //TODO 获取开服时间，作为最小begin，或者1个月前为默认end。当前时间作为最大和默认end。

        $.get(url + begin + '/' + end, {}, function(data) {
            console.log(data);
            var title = data.title;
            var data = {
                labels: data.labels,
                datasets: [{
                    label: title,
                    fillColor: "rgba(220,220,220,0.5)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    data: data.data
                }]
            }
            var config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: title
                    },
                    scales: {
                        xAxes: [{
                            display: true
                        }],
                        yAxes: [{
                            display: true
                        }]
                    }
                }
            };
            new Chart(ctx, config);
        });
    }
</script>